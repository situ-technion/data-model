<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <!-- link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css "-->
    <script type="text/javascript">
      function onLoadPRSuccess(params) {
        console.log("HTML running onLoadPRSuccess " + params);
        var workedOn = document.getElementById('whatIWorkedOn');
        var todo = document.getElementById('whatElseNeedsWork');

        workedOn.value = params['WORKED_ON'];
        console.log("HTML running onLoadPRSuccess workedOn.value:" + params['WORKED_ON']);
        todo.value = params['TODO'];
        console.log("HTML running onLoadPRSuccess workedOn.value:" + params['TODO']);

        markPRSelection(params['IMAGE_ID']);
      }

      function markPRSelection(imageId) {
        var tableCells = document.getElementById("prTable").getElementsByTagName("td");
        for (cell of tableCells) {
          cell.style.backgroundColor = "";   
        }
        var prIcon = document.getElementById(imageId);
        prIcon.style.backgroundColor = "#999999";
      }

      function onSavePRSuccess(imageId) {
        console.log("HTML running onSavePRSuccess, got id:" + imageId);
      }

      function onFailure(error) {
        var div = document.getElementById('output');
        console.log("HTML error " + error);
      }

      function addPRIcon(imageIdx) {
        console.log("HTML running addPRIcon, index ", imageIdx);

        var workedOn = document.getElementById('whatIWorkedOn').value;
        console.log("workedOn value:" + workedOn);

        var todo = document.getElementById('whatElseNeedsWork').value;
        console.log("todo value:" + todo);

        markPRSelection(imageIdx);

        var params = [imageIdx, workedOn, todo];

        console.log("metaData value:" + params);

        google.script.run
          .withFailureHandler(onFailure)
          .withSuccessHandler(onSavePRSuccess)
          .callLibraryFunction("SITULib.addPRIcon", params);
      }

      function addPRIconLow() {   
        console.log("HTML running addPRIconLow");

        addPRIcon(0);
      }

      function addPRIconMed() {   
        console.log("HTML running addPRIconMed");
        addPRIcon(1);
      }

      function addPRIconHigh() {   
        console.log("HTML running addPRIconHigh");
        addPRIcon(2);
      }

      function savePR() {
        console.log("HTML running savePR");
        google.script.run
        .withFailureHandler(onFailure)
        .callLibraryFunction("SITULib.savePR");
      }

      function loadPR() {
        console.log("HTML running loadPR");
        google.script.run
        .withFailureHandler(onFailure)
        .withSuccessHandler(onLoadPRSuccess)
        .callLibraryFunction("SITULib.loadPR");
      }
      </script>
  </head>
  <body>
    <p style="text-align: center;">
      <img style="display: block; margin-left: auto; margin-right: auto;" src="https://situ-technion.herokuapp.com/statics/image.png" alt="" width="57" height="84" />
      מוכנות הפסקה
    </p>

    <p>
      <table id="prTable" style="border-collapse: collapse; width: 100%;" border="1">
        <tbody>
        <tr>
        <td id="0" style="text-align: center;"><input height="64" src="https://situ-technion.herokuapp.com/statics/red64x64.png" type="image" width="64" onclick="addPRIconLow()"/></td>
        <td id="1" style="text-align: center;"><input height="64" src="https://situ-technion.herokuapp.com/statics/yellow64x64.png" type="image" width="64" onclick="addPRIconMed()"/></td>
        <td id="2" style="text-align: center;"><input height="64" src="https://situ-technion.herokuapp.com/statics/green64x64.png" type="image" width="64" onclick="addPRIconHigh()"/></td>
        </tr>
        <tr>
        <td style="text-align: center;">דורש עבודה</td>
        <td>&nbsp;</td>
        <td style="text-align: center;">מוכן</td>
        </tr>
        </tbody>
      </table>
    </p>

    <div class="block">
        <label for="whatIWorkedOn" style="text-align: center;">על מה עבדתי</label>

        <textarea id="whatIWorkedOn" name="whatIWorkedOn" rows="10" cols="35">
        </textarea>
    </div>


    <div class="block">
        <label for="whatElseNeedsWork" style="text-align: center;">היכן נדרשת עוד עבודה</label>

        <textarea id="whatElseNeedsWork" name="whatElseNeedsWork" rows="10" cols="35">
        </textarea>
    </div>

    <p><button type="button" onclick="savePR()">שמור</button></p>
    <p><button type="button" onclick="loadPR()">רענן</button></p>
  </body>
</html>
  